<routes xmlns="http://camel.apache.org/schema/spring">
    <route id="shutdown-route">
        <from uri="direct:shutdown-route" />

        <script>
            <method beanType="org.openmrs.eip.app.CustomFileOffsetBackingStore" method="disable()" />
        </script>
        
        <doTry>
        	<toD uri="direct:send-notification-email-route" />
        	<doCatch>
				<exception>java.lang.Exception</exception>
				<log message="An error ocurred trying to notify to email ${exception.message}" loggingLevel="INFO" />
			</doCatch>
		</doTry>
		
        <log loggingLevel="ERROR" message="An error occurred, cause: ${exception.message}" />
        <log message="Shutting down the application..." />

        <script>
            <method beanType="org.openmrs.eip.app.SyncApplication" method="shutdown()" />
        </script>
    </route>
</routes>
