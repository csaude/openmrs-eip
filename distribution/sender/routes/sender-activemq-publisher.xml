<routes xmlns="http://camel.apache.org/schema/spring">

    <route id="sender-activemq-publisher" errorHandlerRef="shutdownErrorHandler">
    
        <from uri="direct:sender-activemq-publisher" />

        <log message="Fetching next 500 sender sync messages" loggingLevel="DEBUG" />

        <toD uri="jpa:SenderSyncMessage?query=SELECT m FROM SenderSyncMessage m WHERE m.status = 'NEW' ORDER BY m.dateCreated ASC, m.id ASC&amp;maximumResults=500" />

        <choice>
            <when>
                <simple>${body.size()} > 0</simple>
                <log message="Fetched ${body.size()} sender sync message(s)" />
                
                <process ref="senderActiveMqPublisherProcessor" />
            </when>
            <otherwise>
                <log message="No sender sync messages found" loggingLevel="DEBUG" />
            </otherwise>
        </choice>
    </route>
</routes>
