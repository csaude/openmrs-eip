<routes xmlns="http://camel.apache.org/schema/spring">
    <route id="inbound-complex-obs-sync" errorHandlerRef="deadLetterChannelBuilder">
        <from uri="direct:inbound-complex-obs-sync"/>

        <log message="Processing inbound complex obs data file: ${headers.CamelFileName}" />
        
        <unmarshal>
            <base64/>
        </unmarshal>

        <to uri="file:{{camel.input.endpoint.complex.obs.data.directory}}" />

        <log loggingLevel="DEBUG" message="Enabling message acknowledgement after saving complex obs" />

        <script>
            <method beanType="org.openmrs.eip.app.CustomMessageListenerContainer" method="enableAcknowledgement()" />
        </script>
    </route>
</routes>
