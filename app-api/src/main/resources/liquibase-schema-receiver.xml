<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog contextFilter="receiver"
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
	    http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-latest.xsd">

    <changeSet author="wluyima" id="1703147143886-36">
        <createTable tableName="site_info">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="site_district" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="identifier" type="VARCHAR(255)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="date_created" type="datetime">
                <constraints nullable="false"/>
            </column>
            <column name="site_instance_name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="sync_disabled" type="BIT(1)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet author="wluyima" id="1703147143886-33">
        <createTable tableName="receiver_sync_status">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="site_info_id" type="BIGINT">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="last_sync_date" type="datetime">
                <constraints nullable="false"/>
            </column>
            <column name="date_created" type="datetime">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet author="wluyima" id="1703147143886-31">
        <createTable tableName="receiver_sync_msg">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="model_class_name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="identifier" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="entity_payload" type="TEXT">
                <constraints nullable="false"/>
            </column>
            <column name="site_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="date_created" type="datetime"/>
            <column defaultValueNumeric="0" name="is_snapshot" type="BIT(1)">
                <constraints nullable="false"/>
            </column>
            <column name="message_uuid" type="VARCHAR(38)"/>
            <column name="date_sent_by_sender" type="datetime">
                <constraints nullable="false"/>
            </column>
            <column name="operation" type="VARCHAR(1)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet author="wluyima" id="1703147143886-34">
        <createTable tableName="receiver_synced_msg">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="model_class_name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="identifier" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="entity_payload" type="TEXT">
                <constraints nullable="false"/>
            </column>
            <column name="site_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="operation" type="VARCHAR(1)">
                <constraints nullable="false"/>
            </column>
            <column name="is_snapshot" type="BIT(1)">
                <constraints nullable="false"/>
            </column>
            <column name="message_uuid" type="VARCHAR(38)"/>
            <column name="date_sent_by_sender" type="datetime">
                <constraints nullable="false"/>
            </column>
            <column name="date_received" type="datetime">
                <constraints nullable="false"/>
            </column>
            <column name="sync_outcome" type="VARCHAR(50)">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="response_sent" type="BIT(1)">
                <constraints nullable="false"/>
            </column>
            <column name="is_cached" type="BIT(1)">
                <constraints nullable="false"/>
            </column>
            <column name="evicted_from_cache" type="BIT(1)">
                <constraints nullable="false"/>
            </column>
            <column name="is_indexed" type="BIT(1)">
                <constraints nullable="false"/>
            </column>
            <column name="search_index_updated" type="BIT(1)">
                <constraints nullable="false"/>
            </column>
            <column name="date_created" type="datetime">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    
    <changeSet author="wluyima" id="1703147143886-29">
        <createTable tableName="receiver_retry_queue">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="model_class_name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="identifier" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="entity_payload" type="TEXT">
                <constraints nullable="false"/>
            </column>
            <column name="attempt_count" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="message" type="VARCHAR(1024)"/>
            <column name="date_created" type="datetime">
                <constraints nullable="false"/>
            </column>
            <column name="date_changed" type="datetime"/>
            <column name="exception_type" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="site_id" type="BIGINT"/>
            <column name="date_sent_by_sender" type="datetime">
                <constraints nullable="false"/>
            </column>
            <column name="operation" type="VARCHAR(1)">
                <constraints nullable="false"/>
            </column>
            <column name="message_uuid" type="VARCHAR(38)"/>
            <column defaultValueNumeric="0" name="is_snapshot" type="BIT(1)">
                <constraints nullable="false"/>
            </column>
            <column name="date_received" type="datetime">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet author="wluyima" id="1703147143886-27">
        <createTable tableName="receiver_conflict_queue">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="date_created" type="datetime">
                <constraints nullable="false"/>
            </column>
            <column name="entity_payload" type="TEXT">
                <constraints nullable="false"/>
            </column>
            <column name="identifier" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="model_class_name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="site_id" type="BIGINT"/>
            <column name="date_sent_by_sender" type="datetime">
                <constraints nullable="false"/>
            </column>
            <column name="operation" type="VARCHAR(1)">
                <constraints nullable="false"/>
            </column>
            <column name="message_uuid" type="VARCHAR(38)"/>
            <column defaultValueNumeric="0" name="is_snapshot" type="BIT(1)">
                <constraints nullable="false"/>
            </column>
            <column name="date_received" type="datetime">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    
    <changeSet author="wluyima" id="1703147143886-30">
        <createTable tableName="receiver_sync_archive">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="model_class_name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="identifier" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="entity_payload" type="TEXT">
                <constraints nullable="false"/>
            </column>
            <column name="site_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="operation" type="VARCHAR(1)">
                <constraints nullable="false"/>
            </column>
            <column name="is_snapshot" type="BIT(1)">
                <constraints nullable="false"/>
            </column>
            <column name="message_uuid" type="VARCHAR(38)"/>
            <column name="date_sent_by_sender" type="datetime">
                <constraints nullable="false"/>
            </column>
            <column name="date_received" type="datetime"/>
            <column name="date_created" type="datetime">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet author="wluyima" id="1703147143886-28">
        <createTable tableName="receiver_pruned_item">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="model_class_name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="identifier" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="entity_payload" type="TEXT">
                <constraints nullable="false"/>
            </column>
            <column name="site_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="operation" type="VARCHAR(1)">
                <constraints nullable="false"/>
            </column>
            <column name="is_snapshot" type="BIT(1)">
                <constraints nullable="false"/>
            </column>
            <column name="message_uuid" type="VARCHAR(38)"/>
            <column name="date_sent_by_sender" type="datetime">
                <constraints nullable="false"/>
            </column>
            <column name="date_received" type="datetime"/>
            <column name="date_created" type="datetime">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet author="wluyima" id="1703147143886-32">
        <createTable tableName="receiver_sync_request">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="table_name" type="VARCHAR(100)">
                <constraints nullable="false"/>
            </column>
            <column name="identifier" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="site_id" type="BIGINT"/>
            <column name="status" type="VARCHAR(50)">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="found" type="BIT(1)">
                <constraints nullable="false"/>
            </column>
            <column name="request_uuid" type="VARCHAR(38)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="date_created" type="datetime">
                <constraints nullable="false"/>
            </column>
            <column name="date_received" type="datetime"/>
            <column name="date_sent" type="datetime"/>
        </createTable>
    </changeSet>
    
</databaseChangeLog>
